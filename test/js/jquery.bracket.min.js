!function(e){e.fn.gracket=function(a){e.fn.gracket.defaults={gracketClass:"g_gracket",gameClass:"g_game",roundClass:"g_round",roundLabelClass:"g_round_label",teamClass:"g_team",winnerClass:"g_winner",spacerClass:"g_spacer",currentClass:"g_current",seedClass:"g_seed",cornerRadius:15,canvasId:"g_canvas",canvasClass:"g_canvas",canvasLineColor:"#000",canvasLineCap:"round",canvasLineWidth:2,canvasLineGap:15,roundLabels:[],src:[]};var t,s,n,i=this,r="undefined"==typeof i.data("gracket")?[]:"string"==typeof i.data("gracket")?JSON.parse(i.data("gracket")):i.data("gracket"),o=[];e.fn.gracket.settings={};var l={init:function(a){this.gracket.settings=e.extend({},this.gracket.defaults,a),this.gracket.settings.src.length&&(r=this.gracket.settings.src),this.gracket.settings.canvasId=this.gracket.settings.canvasId+"_"+(new Date).getTime();var l=document.createElement("canvas");l.id=this.gracket.settings.canvasId,l.className=this.gracket.settings.canvasClass,l.style.position="absolute",l.style.zIndex="9999",l.style.left=0,l.style.top=0,l.height=100,l.style.right="auto",i.addClass(this.gracket.settings.gracketClass).prepend(l),s=r.length;for(var c=0;s>c;c++){var g=d.build.round(this.gracket.settings);i.append(g),n=r[c].length;for(var h=0;n>h;h++){var p=d.build.game(this.gracket.settings),v=i.find("."+this.gracket.settings.gameClass).outerHeight(!0),u=d.build.spacer(this.gracket.settings,v,c,0!==c&&0===h?!0:!1);h%1==0&&0!==c&&g.append(u),g.append(p),t=r[c][h].length;for(var f=0;t>f;f++){var m=d.build.team(r[c][h][f],this.gracket.settings);p.append(m);var C=m.outerWidth(!0);(void 0===o[c]||o[c]<C)&&(o[c]=C),1===t&&(p.prev().remove(),d.align.winner(p,this.gracket.settings,p.parent().prev().children().eq(0).height()),d.listeners(this.gracket.settings,r,p.parent().prev().children().eq(1)))}}}}},d={build:{team:function(a,t){if("undefined"==typeof a.url)var s=["<h3"+("undefined"==typeof a.score?"":' title="Score: '+a.score+'"')+">",'<span class="'+t.seedClass+'">',"undefined"==typeof a.displaySeed?a.seed:a.displaySeed,"</span>","&nbsp;"+a.name+"&nbsp;","<small>","undefined"==typeof a.score?"":a.score,"</small>","</h3>"].join("");else var s=["<h3"+("undefined"==typeof a.score?"":' title="Score: '+a.score+'"')+' data-url="'+a.url+'">','<span class="'+t.seedClass+'">',"undefined"==typeof a.displaySeed?a.seed:a.displaySeed,"</span>","&nbsp;"+a.name+"&nbsp;","<small>","undefined"==typeof a.score?"":a.score,"</small>","</h3>"].join("");return team=e("<div />",{html:s,"class":t.teamClass+" "+(a.id||"id_null")})},game:function(a){return game=e("<div />",{"class":a.gameClass})},round:function(a){return round=e("<div />",{"class":a.roundClass})},spacer:function(a,t,s,n){return spacer=e("<div />",{"class":a.spacerClass}).css({height:n?(Math.pow(2,s)-1)*(t/2):(Math.pow(2,s)-1)*t})},labels:function(a,t){var s,n,r=t,l=a.length,d=0;for(s=0;l>s;s++)n=0===s?r.padding+d:r.padding+d+r.right*s,e("<h5 />",{html:r.labels.length?r.labels[s]:"Round "+(s+1),"class":r["class"]}).css({position:"absolute",left:n,width:t.width}).prependTo(i),d+=o[s]},canvas:{resize:function(a){var t=document.getElementById(a.canvasId);t.height=i.innerHeight(),t.width=i.innerWidth(),e(t).css({height:i.innerHeight(),width:i.innerWidth(),zIndex:1,pointerEvents:"none"})},draw:function(a,t,s){var n=document.getElementById(a.canvasId);"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(n);var r=n.getContext("2d"),l=o[0],c=s.outerHeight(!0),g=parseInt(i.css("paddingLeft"))||0,h=parseInt(i.css("paddingTop"))||0,p=(parseInt(s.css("marginBottom"))||0,l+g),v=parseInt(i.find("> div").css("marginRight"))||0,u=a.cornerRadius,f=a.canvasLineGap,m=s.height()-2*s.find("> div").eq(1).height();_playerHt=s.find("> div").eq(1).height(),_totalItemWidth=0;var C=(p+v)*t.length;e(".g_gracket").css("width",C+"px"),u>c/3&&(u=c/3),u>v/2&&(u=v/2-2),0>=u&&(u=1),f>v/3&&(f=v/3),r.strokeStyle=a.canvasLineColor,r.lineCap=a.canvasLineCap,r.lineWidth=a.canvasLineWidth,r.beginPath();var k,y=Math.pow(2,t.length-2),b=0,T=.5,w=0===b&&1===y?!0:!1;if(w){var _=e("."+a.gameClass),I=_.eq(_.length-1);c=I.outerHeight(!0),l=I.outerWidth(!0)}for(var L=0,M=0,S=0;y>=1;){for(0==L&&1==SkipFirst&&(L=y),k=0;y>k;k++){1==y&&(T=1);var W=w?l+g:p+_totalItemWidth+b*v,H=T*v,q=((Math.pow(2,b-1)-.5)*(b&&1)+k*Math.pow(2,b))*c+h+(w?_.find("> div").eq(1).height():_playerHt)+m/2;if(y!=L?y>1?(r.moveTo(W+f,q),r.lineTo(W+H-u,q)):(r.moveTo(W+f,q),r.lineTo(W+3*f,q)):S<ShowFirst&&(y>1?(r.moveTo(W+f,q),r.lineTo(W+H-u,q)):(r.moveTo(W+f,q),r.lineTo(W+3*f,q)),S++),y>1&&k%2==0&&y!=L){var x=q+u,E=q+Math.pow(2,b)*c-u;r.moveTo(W+H,x),r.lineTo(W+H,E);var j=W+H-u,z=q+u;r.moveTo(j,z-u),r.arcTo(j+u,z-u,j+u,z,u),z=q+Math.pow(2,b)*c-u,r.moveTo(j+u,z-u),r.arcTo(j+u,z+u,j,z+u,u);var G=(x+E)/2;r.moveTo(W+H,G),r.lineTo(W+H+f,G)}else if(y>1&&k%2==0&&M<ShowFirst){M++;var x=q+u,E=q+Math.pow(2,b)*c-u;r.moveTo(W+H,x),r.lineTo(W+H,E);var j=W+H-u,z=q+u;r.moveTo(j,z-u),r.arcTo(j+u,z-u,j+u,z,u),z=q+Math.pow(2,b)*c-u,r.moveTo(j+u,z-u),r.arcTo(j+u,z+u,j,z+u,u);var G=(x+E)/2;r.moveTo(W+H,G),r.lineTo(W+H+f,G)}}b++,l=o[b],_totalItemWidth+=l,y/=2}r.stroke(),d.build.labels(t,{padding:g,left:p,right:v,labels:a.roundLabels,"class":a.roundLabelClass})}}},align:{winner:function(e,a,t){var s=1===e.parent().siblings().not("canvas").length?!0:!1,n=s?t-(e.height()+e.height()/2):t+e.height()/2;return e.addClass(a.winnerClass).css({"margin-top":n})}},listeners:function(a,t,s){var n="."+a.teamClass+" > h3";e.each(e(n),function(t){var s="."+e(this).parent().attr("class").split(" ")[1];void 0!==s&&e(s).hover(function(){e(s).addClass(a.currentClass)},function(){e(s).removeClass(a.currentClass)})}),d.build.canvas.resize(a),d.build.canvas.draw(a,t,s)}};return l[a]?l[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void e.error('Method "'+a+'" does not exist in gracket!'):l.init.apply(this,arguments)}}(jQuery);